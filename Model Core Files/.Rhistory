library("flexsurv")
install.packages("flexsurv")
library("flexsurv")
library(readxl)
exp <- read_excel("//nask.man.ac.uk/home$/Desktop/exp.xlsx",
col_types = c("numeric", "numeric", "numeric",
"numeric", "numeric", "numeric",
"numeric"))
View(exp)
flexsurvreg(formula=Surv(exp[,1],exp[,3])~1,dist="exponential")
View(exp)
data<-exp
flexsurvreg(formula=Surv(data[,1],data[,3])~1,dist="exponential")
data[,1]
data[,1]<-asnumeric(data[,1])
data[,1]<-as.numeric(data[,1])
data<-as.data.frame(data)
flexsurvreg(formula=Surv(data[,1],data[,3])~1,dist="exponential")
data[,1]
flexsurvreg(formula=Surv(data[,1],data[,3])~1,dist="exponential")
data[,3]
lm(log(data[,2]~data[,1]))
lm(log(data[,2])~data[,1])
print(utlity_ages)
#Set age adjusted utility values
utility_ages<-data.frame(c(30,35,40,45,50,55,60,65,70,75,80,85,90,95,100),
c(0.9383,0.9145,0.9069,0.8824,0.8639,0.8344,0.8222,0.8072,0.8041,0.779,0.7533,0.6985,0.6497,0.6497,0.6497))
print(utlity_ages)
print(utility_ages)
write.csv(utility_ages,"utilityages.csv")
write.csv(utility_ages,file="utilityages.csv")
install.packages("VGAM")
library(VGAM)
library(readxl)
Copy_of_women_2018_20_age_table <- read_excel("//nask.man.ac.uk/home$/Desktop/Copy of women 2018-20 age table.xlsx")
View(Copy_of_women_2018_20_age_table)
Copy_of_women_2018_20_age_table
model<-vglm(w_lx~w_age,family="weibull",data=data)
data1<-as.data.frame(Copy_of_women_2018_20_age_table)
model<-vglm(w_lx~w_age,family="weibull",data=data1)
model<-vglm(w_lx~w_age,family="Weibull",data=data1)
model<-vglm(w_lx~w_age,family=Weibull,data=data1)
model<-vglm(formula=w_lx~w_age,family=Weibull,data=data1)
model<-vglm(formula=w_lx~w_age,family=weibull,data=data1)
library(flexsurv)
model<-survreg(w_lx~w_age,dist="weibull",data=data1)
model<-vglm(formula=w_lx~w_age,dist=weibull,data=data1)
model<-vglm(formula=w_lx~w_age,family=weibull,data=data1)
library(fitdistrplus)
fitdist(w_qx,"weibull")
fitdist(w_qx,"weibull",data=data1)
fitdist(data1[,9],"weibull",data=data1)
fitdist(data1[,9],"weibull")
fitdist(data1[,12],"weibull")
fitdist(data1[,11],"weibull")
fitdist(data1[,10],"weibull")
fitdist(data[,7]*(data1[,10]/100000),"weibull")
fitdist(data1[,7]*(data1[,10]/100000),"weibull")
fitdist((data1[,7]+1)*(data1[,10]/100000),"weibull")
rweibull(100,shape=1.755,scale=39.67)
weib<-rweibull(100,shape=1.755,scale=39.67)
plot(density(weib))
weibdist<-fitdist((data1[,10]),"weibull")
weib<-rweibull(100,shape=weibdist[1],scale=weibdist[2])
weibdist
weibdist<-fitdist((data1[,11]),"weibull")
weibdist
library(fitdistrplus)
agevect<-data[,7]
agevect<-data1[,7]
deathvect<-data[,11]
deathvect<-data1[,11]
survdata<-c(length(100000)))
survdata<-c(length(100000))
print(survdata)
survdata<-vector(length=100000)
for i in length(survdata){
survdata[1:round(deathvect[i])]<-agevect[i]
}
for i in length(survdata)(
survdata[1:round(deathvect[i])]<-agevect[i]
)
for i in length(survdata){
survdata[1:round(deathvect[i])]<-agevect[i]
}
for i in length(survdata){
survdata[1:round(deathvect[i])]<-agevect[i]
}
for i in length(survdata){
survdata[1:round(deathvect[i])]<-agevect[i]
}
for i in length(survdata){
survdata[1:round(deathvect[i])]<-agevect[i]
}
}
for i in length(survdata){
survdata[1:round(deathvect[i])]<-agevect[i]
}
for (i in length(survdata)){
survdata[1:round(deathvect[i])]<-agevect[i]
}
print(deathvect)
survdata[1:round(deathvect[i])]<-agevect[i]
survdata[1:round(deathvect[1])]<-agevect[1]
survdata[1:round(deathvect[2])]<-agevect[2]
print(surv_data)
print(survdata)
{
survdata[1:round(deathvect[i])]<-agevect[i]
}
deathvect<-round(deathvect)
which(survdata==0)
which(survdata==0)[1]
for (i in length(survdata)){
survdata[which(survdata==0)[1]:deathvect[i]]<-agevect[i]
}
survdata<-vector(length=100000)
print(deathvect)
agevect<-data1[,7]
print(agevect)
length(agevect)
length(deathvect)
rm(survdata)
for (i in length(survdata)){
survdata[which(survdata==0)[1]:deathvect[i]]<-agevect[i]
}
survdata<-c()
for (i in length(survdata)){
survdata[which(survdata==0)[1]:deathvect[i]]<-agevect[i]
}
survdata<-vector(length=sum(deathvect))
for (i in length(survdata)){
survdata[which(survdata==0)[1]:deathvect[i]]<-agevect[i]
}
which(survdata==0)[1]
typeof(which(survdata==0)[1])
for (i in length(survdata)){
survdata[as.numeric(which(survdata==0)[1]):deathvect[i]]<-agevect[i]
}
for (i in length(deathvect)){
survdata[which(survdata==0)[1]:deathvect[i]]<-agevect[i]
}
print(survdata)
rm(survdata)
survdata<-vector(length=sum(deathvect))
survdata[which(survdata==0)[1]:deathvect[1]]<-agevect[1]-1
for (i in length(deathvect)){
survdata[which(survdata==0)[1]:deathvect[i+1]]<-agevect[i+1]
}
for (i in length(deathvect)-1){
survdata[which(survdata==0)[1]:deathvect[i+1]]<-agevect[i+1]
}
(survdata)
survdata<-sample(agevect,100000,prob=deathvect/100000)
survdata<-sample(agevect,100000,prob=deathvect/100000,replace=TRUE)
print(survdata)
weibdist<-fitdist(survdata,"weibull")
print(survdata)
which(survdata=="NA")
typeof(survdata)
weibdist<-fitdist(survdata,"weibull")
density(survdata)
plot(density(survdata))
which(survdata<0)
weibdist<-fitdist(survdata,"weibull",data=survdata)
fitdist(survdata,"normal")
library(fitdistrplus)
fitdist(survdata,"normal")
weibdist<-fitdist(survdata,dist="weibull")
typeof(survdata)
median(survdata)
weibdist<-fitdist(survdata,dist="weibull")
weibdist<-fitdistr(survdata,dist="weibull")
weibdist<-fitdist(survdata,distr="weibull")
which(survdata=="NaN")
which(is.na(survdata)
weibdist<-fitdist(survdata,distr="weibull")
weibdist<-fitdist(survdata,distr="weibull")
survdata<-sample(agevect,100000,prob=deathvect/100000,replace=TRUE)
weibdist<-fitdist(survdata,distr="weibull")
weibdist<-fitdist(as.numeric(survdata),distr="weibull")
weibdist<-fitdist(survdata,distr="weibull")
write.csv(survdata,file="survdata")
write.csv(survdata,file="survdata.csv")
weibdist<-fitdist(survdata+1,distr="weibull")
if(survdata==0){survdata<-0.01}
if(survdata[,]==0){survdata[,]<-0.01}
View(weibdist)
View(weibdist)
for (i in length(survdata)){
if(survdata[i]==0){survdata[i]<-0.01}
}
weibdist<-fitdist(survdata,distr="weibull")
if(survdata[i]==0){survdata[i]<-0.01}
for (i in length(survdata)){
if(survdata[i]==0){survdata[i]<-0.01}
}
weibdist<-fitdist(survdata,distr="weibull")
for (i in length(survdata)){
if(survdata[i]==0){survdata[i]<-0.1}
}
weibdist<-fitdist(survdata,distr="weibull")
survdata<-sample(agevect,100000,prob=deathvect/100000,replace=TRUE)
for (i in length(survdata)){
if(survdata[i]==0){survdata[i]<-0.1}
}
weibdist<-fitdist(survdata,distr="weibull")
for (i in length(survdata)){
if(survdata[i]=0){survdata[i]<-0.1}
}
for (i in length(survdata)){
if(survdata[i]==0){survdata[i]<-0.1}
}
which(survdata==0)
survdata<-sample(agevect,100000,prob=deathvect/100000,replace=TRUE)
for (i in length(survdata)){
if(survdata[i]==0){survdata[i]<-0.1}
}
weibdist<-fitdist(survdata,distr="weibull")
survdata<-sample(agevect,100000,prob=deathvect/100000,replace=TRUE)
weibdist<-fitdist(survdata+0.01,distr="weibull")
print(weibdist)
survdata<-sample(agevect,100000,prob=deathvect/100000,replace=TRUE)
weibdist<-fitdist(survdata+1,distr="weibull")
print(weibdist)
weib<-rweibull(100,shape=weibdist[1],scale=weibdist[2])
weib<-rweibull(100,shape=8.326232,scale=87.649396)
print(weib)
weib<-rweibull(100000,shape=8.326232,scale=87.649396)
print(weib)
density(weib)
plot(density(weib))
plot(density(survdata))
plot(density(survdata))
plot(density(survdata))
plot(density(weib))
plot(density(survdata))
plot(density(weib))
survdata<-sample(agevect,100000,prob=deathvect/100000,replace=TRUE)
weibdist<-fitdist(survdata+1,distr="weibull")
weibdist
survdata<-sample(agevect,100000,prob=deathvect/100000,replace=TRUE)
weibdist<-fitdist(survdata+1,distr="weibull")
weibdist
survdata<-sample(agevect,100000,prob=deathvect/100000,replace=TRUE)
weibdist<-fitdist(survdata+1,distr="weibull")
weibdist
survdata<-sample(agevect,100000,prob=deathvect/100000,replace=TRUE)
weibdist<-fitdist(survdata+1,distr="weibull")
weibdist
survdata<-sample(agevect,100000,prob=deathvect/100000,replace=TRUE)
weibdist<-fitdist(survdata+0.001,distr="weibull")
weibdist
survdata<-sample(agevect,100000,prob=deathvect/100000,replace=TRUE)
weibdist<-fitdist(survdata+0.001,distr="weibull")
weibdist
survdata<-sample(agevect,100000,prob=deathvect/100000,replace=TRUE)
weibdist<-fitdist(survdata+0.001,distr="weibull")
weibdist
plot(weibdist)
plot(weibdist)
weib<-rweibull(100000,shape=7.362,scale=86.286)
plot(weib)
plot(weib)
plot(weib)
weibdist<-fitdist((data1[,11]),"weibull")
weibdist
weib<-rweibull(100000,shape=7.362,scale=86.286)
plot(density(weib))
survdata<-sample(agevect,100000,prob=deathvect/100000,replace=TRUE)
weibdist<-fitdist(survdata+0.001,distr="weibull")
weibdist
plot(weib)
survdata<-sample(agevect,100000,prob=deathvect/100000,replace=TRUE)
weibdist<-fitdist(survdata+0.001,distr="weibull")
weibdist
plot(weib)
par(mar=c(1,1,1,1))
plot(weib)
par(mar)
par("mar")
plot(weib)
par(mar=c(1,1,1,1))
plot(weib)
survdata<-sample(agevect,100000,prob=deathvect/100000,replace=TRUE)
weibdist<-fitdist(survdata+0.001,distr="weibull")
plot(weib)
weib<-rweibull(100000,shape=7.362,scale=86.286)
plot(density(weib))
par(mar=c(1,1,1,1))
plot(density(weib))
survdata<-sample(agevect,100000,prob=deathvect/100000,replace=TRUE)
weibdist<-fitdist(survdata+0.001,distr="weibull")
library(readxl)
Copy_of_women_2018_20_age_table <- read_excel("//nask.man.ac.uk/home$/Desktop/Copy of women 2018-20 age table.xlsx")
View(Copy_of_women_2018_20_age_table)
data1<-Copy_of_women_2018_20_age_table <- read_excel("//nask.man.ac.uk/home$/Desktop/Copy of women 2018-20 age table.xlsx")
data1<- read_excel("//nask.man.ac.uk/home$/Desktop/Copy of women 2018-20 age table.xlsx")
View(data1)
View(data1)
agevect<-data1[,7]
deathvect<-data1[,11]
survdata<-sample(agevect,100000,prob=deathvect/100000,replace=TRUE)
survdata<-sample(agevect,100000,prob=deathvect/100000,replace=TRUE)
agevect<-data1[,7]
deathvect<-data1[,11]
agevect<-as.numeric(data1[,7])
data1<- as.data.frame(read_excel("//nask.man.ac.uk/home$/Desktop/Copy of women 2018-20 age table.xlsx"))
agevect<-data1[,7]
deathvect<-data1[,11]
survdata<-sample(agevect,100000,prob=deathvect/100000,replace=TRUE)
weibdist<-fitdist(survdata+0.001,distr="weibull")
library(fitdistrplus)
weibdist<-fitdist(survdata+0.001,distr="weibull")
weibdist
paramweib<-unlist(weibdist)
paramweib<-unlist([weibdist[1])
paramweib<-unlist(weibdist[1])
print(paramweib)
weibsim<-rweibull(100000,paramweib[1],paramweib[2])
plot(density(weibsim))
plot(density(weibsim),density(survdata))
plot(density(weibsim),density(survdata))
plot(density(weibsim))
lines(density(survdata))
plot(density(weibsim),ylim=0.05)
lines(density(survdata))
plot(density(weibsim),ylim=c(0,0.05))
lines(density(survdata))
plot(density(weibsim),ylim=c(0,0.05),colour="red")
lines(density(survdata))
plot(density(weibsim),ylim=c(0,0.05),col="red")
lines(density(survdata))
weibdist<-fitdist(survdata+1,distr="weibull")
weibdist
paramweib<-unlist(weibdist[1])
weibsim<-rweibull(100000,paramweib[1],paramweib[2])
plot(density(weibsim),ylim=c(0,0.05),col="red")
lines(density(survdata))
weibdist<-fitdist(survdata+0.0001,distr="weibull")
weibdist
paramweib<-unlist(weibdist[1])
weibsim<-rweibull(100000,paramweib[1],paramweib[2])
plot(density(weibsim),ylim=c(0,0.05),col="red")
lines(density(survdata))
weibdist<-fitdist(survdata+1,distr="weibull")
weibdist
paramweib<-unlist(weibdist[1])
weibsim<-rweibull(100000,paramweib[1],paramweib[2])
plot(density(weibsim),ylim=c(0,0.05),col="red")
lines(density(survdata))
simdata<-risk_mat[sample(nrow(risk_mat),inum,replace=TRUE),]
load("~/GitHub/MANC-RISK-SCREEN/Model Core Files/PSA_values.RData")
riskcomp<-read.table(file="clipboard",sep="\t",header=TRUE)
plot(riskcomp[,3],riskcomp[,4])
plot(riskcomp[,3],riskcomp[,4])
abline(a=0,b=1)
plot(riskcomp[,2],riskcomp[,3])
abline(a=0,b=1)
plot(riskcomp[,3],riskcomp[,4])
abline(a=0,b=1)
plot(riskcomp[,3],riskcomp[,5])
abline(a=0,b=4.545)
plot(riskcomp[,3],riskcomp[,4])
abline(a=0,b=1)
hist(riskcom[,3])
hist(riskcomp[,3])
install.packages("devtools")
install.packages("devtools")
library(devtools)
library(magrittr)
library(here)
install.packages("here")
library("mgcv")
library("BCEA")
library(tidyverse)
library(here)
library(magrittr)
library(devtools)
install.packages("devtools")
install.packages("devtools")
install.packages("devtools")
install.packages("devtools")
install.packages("devtools")
library(devtools)
install.packages("cli")
install.packages("cli")
install.packages("cli")
install.packages("devtools")
install.packages("devtools")
library("mgcv")
library("BCEA")
library(tidyverse)
library(here)
library(magrittr)
library(devtools)
remove.packages("cli")
install.packages("cli")
install.packages("cli")
install.packages("devtools")
install.packages("devtools")
library("mgcv")
library("BCEA")
library(tidyverse)
library(here)
library(magrittr)
library(devtools)
install.packages("usethis")
install.packages("usethis")
install.packages("devtools")
library(devtools)
alt_names<-c("noscreening","procas","tertiles","3yr","2yr","5yr",
"10yr","lowrisk5yr","lowrisk6yr","fullstrat")
subD <- "GAM inputs"
load(here(subD, "PSA_values.RData"))
install.packages("here")
library(here)
alt_names<-c("noscreening","procas","tertiles","3yr","2yr","5yr",
"10yr","lowrisk5yr","lowrisk6yr","fullstrat")
subD <- "GAM inputs"
load(here(subD, "PSA_values.RData"))
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
alt_names<-c("noscreening","procas","tertiles","3yr","2yr","5yr",
"10yr","lowrisk5yr","lowrisk6yr","fullstrat")
subD <- "GAM inputs"
load(here(subD, "PSA_values.RData"))
here()
alt_names<-c("noscreening","procas","tertiles","3yr","2yr","5yr",
"10yr","lowrisk5yr","lowrisk6yr","fullstrat")
subD <- "GitHub/MANC-RIK-SCREEN/Model Core Files/GAM inputs"
load(here(subD, "PSA_values.RData"))
subD <- "GitHub\MANC-RIK-SCREEN\Model Core Files\GAM inputs"
load(here(subD, "PSA_values.RData"))
subD <- "GitHub\MANC-RISK-SCREEN\Model Core Files\GAM inputs"
load(here(subD, "PSA_values.RData"))
subD <- "GitHub\MANC-RISK-SCREEN\Model Core Files\GAM inputs"
load(here(subD, "PSA_values.RData"))
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
library(here)
subD <- "GAM inputs"
load(here(subD, "PSA_values.RData"))
subD <- "GitHub\MANC-RISK-SCREEN\Model Core Files\GAM inputs"
load(here(subD, "PSA_values.RData"))
subD <- "GitHub\MANC-RISK-SCREEN\Model Core Files\GAM inputs"
subD <- "GitHub/MANC-RISK-SCREEN/Model Core Files/GAM inputs"
load(here(subD, "PSA_values.RData"))
PSA_all <- tibble(strat = factor(alt_names)) %>%
pmap_dfr(~ read.csv(here(subD, paste0(.x, "_PSA.csv"))) %>%
set_names(c("id","QALY","cost","screens","cancer","screen_detected","LY")) %>%
bind_cols(alternative = .x,
PSA_all_p))
library("mgcv")
library("BCEA")
library(tidyverse)
library(here)
library(magrittr)
library(devtools)
alt_names<-c("noscreening","procas","tertiles","3yr","2yr","5yr",
"10yr","lowrisk5yr","lowrisk6yr","fullstrat")
subD <- "GitHub/MANC-RISK-SCREEN/Model Core Files/GAM inputs"
load(here(subD, "PSA_values.RData"))
PSA_all <- tibble(strat = factor(alt_names)) %>%
pmap_dfr(~ read.csv(here(subD, paste0(.x, "_PSA.csv"))) %>%
set_names(c("id","QALY","cost","screens","cancer","screen_detected","LY")) %>%
bind_cols(alternative = .x,
PSA_all_p))
incCU_PSA <- PSA_all %>%
filter(alternative != "noscreening") %>%
dplyr::select(id, alternative, cost, QALY) %>%
left_join(PSA_all %>%
filter(alternative == "noscreening") %>%
dplyr::select(id,
baseCost = cost,
baseQALY = QALY),
by = "id") %>%
mutate(delta_cost = cost - baseCost,
delta_QALY = QALY - baseQALY)
incCU_PSA %>%
ggplot() +
geom_point(aes(x=delta_QALY, y = delta_cost, colour = alternative))
incCU <- PSA_all %>%
group_by(StratName = alternative) %>%
summarise(Costs = mean(cost),
QALYs = mean(QALY)) %>%
mutate(ID = row_number())
source_gist("https://gist.github.com/gbrlrgrs/5b905bdb5ce597c01f3551746154b45a", encoding = "UTF-8")
incCU %>%
fnIncCU()
source_gist("https://gist.github.com/gbrlrgrs/5b905bdb5ce597c01f3551746154b45a", encoding = "UTF-8")
source_gist("https://gist.github.com/gbrlrgrs/5b905bdb5ce597c01f3551746154b45a", encoding = "UTF-8")
modQ <- bam(data = PSA_all,
formula = QALY ~
s(PSA_gamma_survival_1, by = alternative, bs = "tp") +
s(PSA_gamma_survival_2, by = alternative, bs = "tp") +
s(PSA_gamma_survival_3, by = alternative, bs = "tp") +
s(PSA_meta_survival_54, by = alternative, bs = "tp") +
s(PSA_meta_survival_74, by = alternative, bs = "tp") +
s(PSA_meta_survival_99, by = alternative, bs = "tp") +
s(PSA_beta_1, by = alternative, bs = "tp") +
s(PSA_beta_2, by = alternative, bs = "tp") +
s(PSA_VDG1_sen, by = alternative, bs = "tp") +
s(PSA_VDG2_sen, by = alternative, bs = "tp") +
s(PSA_VDG3_sen, by = alternative, bs = "tp") +
s(PSA_VDG4_sen, by = alternative, bs = "tp") +
s(PSA_MRI_cdr, by = alternative, bs = "tp") +
s(PSA_US_cdr, by = alternative, bs = "tp") +
s(PSA_log_norm_mean, by = alternative, bs = "tp") +
s(PSA_log_norm_sd, by = alternative, bs = "tp") +
s(PSA_util_1to3, by = alternative, bs = "tp") +
s(PSA_util_4, by = alternative, bs = "tp") +
alternative)
summary(modQ)
